<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== Base ===== */
body {
	font-family: Arial, sans-serif;
	margin: 0;
	padding: 0;
	background-color: #1e1e1e;
	color: #ddd;
}

/* ===== Tabs ===== */
.tab {
	display: flex;
	border-bottom: 1px solid #333;
	background-color: #2b2b2b;
}

.tab button {
	background: none;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 12px 18px;
	font-size: 16px;
	color: #bbb;
	transition: background-color 0.2s, color 0.2s;
}

.tab button:hover {
	background-color: #3b3b3b;
	color: #fff;
}

.tab button.active {
	background-color: #444;
	color: #fff;
	border-bottom: 2px solid #ea6161;
}

/* ===== Content Area ===== */
.tabcontent {
	display: none;
	height: calc(100vh - 50px);
	border-top: none;
	background-color: #1e1e1e;
	padding: 0;
}

/* ===== Iframe ===== */
iframe {
	margin: 0;
	padding: 0;
	border: none;
	width: 100%;
	height: 100%;
	background: #1e1e1e;
}

/* ===== Loader ===== */
.loader {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	display: inline-grid;
	font-size: 200px;
	color: #6da9ff;
}

.loader:before,
.loader:after {
	content: "ðŸ’°";
	grid-area: 1/1;
}

.loader:after {
	animation: l10 1s infinite;
}

@keyframes l10 {
	to { transform: scale(1.8); opacity: 0; }
}

/* Chrome, Edge, Safari */
::-webkit-scrollbar {
	width: 10px;
	height: 10px;
	background: #1e1e1e;
}

::-webkit-scrollbar-track {
	background: #1e1e1e;
	border-left: 1px solid #2a2a2a;
}

::-webkit-scrollbar-thumb {
	background: #3a3a3a;
	border-radius: 6px;
	border: 2px solid #1e1e1e;
}

::-webkit-scrollbar-thumb:hover {
	background: #505050;
}

/* Firefox */
* {
	scrollbar-width: thin;
	scrollbar-color: #3a3a3a #1e1e1e;
}


</style>
</head>

<body>

<div class="loader" id="loader"></div>

<div class="tab" id="tab" style="display:none;">
	<button class="tablinks" id="haButton" onclick="openPage(event, 'HighAlchFlips')">HA Flips</button>
	<button class="tablinks" onclick="openPage(event, 'Sets')">Sets</button>
	<button class="tablinks" onclick="openPage(event, 'Components')">Components</button>
	<button class="tablinks" onclick="openPage(event, 'Favourites')">Favourites</button>
	<button class="tablinks" onclick="openPage(event, 'Profit')">Profit</button>
	<button class="tablinks" onclick="openPage(event, 'Margin')">Margin</button>
	<button class="tablinks" onclick="openPage(event, 'PlantPots')">Plant pots</button>
    <button class="tablinks" onclick="refreshPages()">Refresh</button>
</div>

<!-- ===== Tab Content ===== -->
<div id="HighAlchFlips" class="tabcontent">
	<iframe src="subpages/highAlchFlips.html" id="highAlchFlips" onload="resizeIframe(this)"></iframe>
</div>
 

<div id="Sets" class="tabcontent">
	<iframe src="subpages/sets.html" id="sets"></iframe>
</div>

<div id="Components" class="tabcontent">
	<iframe src="subpages/components.html" id="components"></iframe>
</div>

<div id="Favourites" class="tabcontent">
	<iframe src="subpages/favourites.html" id="favourites"></iframe>
</div>

<div id="Profit" class="tabcontent">
	<iframe src="subpages/profit.html" id="profit"></iframe>
</div>

<div id="Margin" class="tabcontent">
	<iframe src="subpages/margin.html" id="margin"></iframe>
</div>

<div id="PlantPots" class="tabcontent">
	<iframe src="subpages/plantPots.html" id="plantPots"></iframe>
</div>

<script src="scripts/libraryFunctions.js"></script>
<script src="scripts/dataLoader.js"></script>

<script>

var intervalCode = null;

window.addEventListener("DOMContentLoaded", async () => {
	await refreshData();           // Wait for data loader
	await waitForIframes();        // Wait for all subpages to load
	await postDataToPages();       // Now safe to message iframes

	showPage();
	document.getElementById("haButton").click();
    intervalCode = setInterval(refreshPages, 60000)
});

async function refreshPages()
{
	await refreshData();           // Wait for data loader
	await postDataToPages();       // Now safe to message iframes
}

async function postDataToPages() {
	const data = window.OSRS.data;
	document.querySelectorAll("iframe").forEach(frame => {
		frame.contentWindow.postMessage(data, "*");
	});
}

function showPage() {
	document.getElementById("loader").style.display = "none";
	document.getElementById("tab").style.display = "flex";
}

function resizeIframe(obj) {
	obj.style.height = (window.innerHeight - 60) + "px";
}

function openPage(evt, pageName) {
	let tabcontent = document.getElementsByClassName("tabcontent");
	for (let i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	}

	let tablinks = document.getElementsByClassName("tablinks");
	for (let i = 0; i < tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	}

	document.getElementById(pageName).style.display = "block";
	evt.currentTarget.className += " active";
}

function waitForIframes() {
	const frames = Array.from(document.querySelectorAll("iframe"));
	return Promise.all(
		frames.map(frame => new Promise(resolve => {
			if (frame.contentWindow && frame.contentDocument?.readyState === "complete") {
				resolve();
			} else {
				frame.onload = () => resolve();
			}
		}))
	);
}
</script>

</body>
</html>
